<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="author" content="Claire Wagner (Summer 2022 Wheaton College Research Team)">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Map of City-Owned Properties</title>

  <!-- Leaflet CDN -->
  <!--link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
    integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
    crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
    integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
    crossorigin=""></script-->

  <!-- Leaflet.markercluster CDN -->
  <!--link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"
    integrity="sha512-RLEjtaFGdC4iQMJDbMzim/dOvAu+8Qp9sw7QE4wIMYcg2goVoivzwgSZq9CsIxp4xKAZPKh5J2f2lOko2Ze6FQ=="
    crossorigin=""/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
    integrity="sha512-BBToHPBStgMiw0lD4AtkRIZmdndhB6aQbXpX7omcrXeG2PauGBl2lzq2xUZTxaLxYz5IDHlmneCZ1IJ+P3kYtQ=="
    crossorigin=""/>
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"
    integrity="sha512-MQlyPV+ol2lp4KodaU/Xmrn+txc1TP15pOBF/2Sfre7MRsA/pB4Vy58bEqe9u7a7DczMLtU5wT8n7OblJepKbg=="
    crossorigin=""></script-->

  <!-- Leaflet.FeatureGroup.SubGroup CDN -->
  <!--script src="https://unpkg.com/leaflet.featuregroup.subgroup@1.0.2/dist/leaflet.featuregroup.subgroup.js"
    integrity="sha512-gUiI5CXREIHHGko8AdlPYADT5MHvcCuqee1pjKR4qVcw69zVI+WvrnJcCxwU8JajpJoBjpvPIAGfDVFoQJhDfw=="
    crossorigin=""></script-->

  <!-- Local copies of scripts and stylesheets -->
  <link rel="stylesheet" href="leaflet/leaflet.css"/>
  <script src="leaflet/leaflet-src.js"></script>
  <link rel="stylesheet" href="leaflet/plugins/MarkerCluster/MarkerCluster.css"/>
  <link rel="stylesheet" href="leaflet/plugins/MarkerCluster/MarkerCluster.Default.css"/>
  <script src="leaflet/plugins/MarkerCluster/leaflet.markercluster-src.js"></script>
  <script src="leaflet/plugins/FeatureGroupSubGroup/leaflet.featuregroup.subgroup-src.js"></script>
  <link rel="stylesheet" href="leaflet/plugins/ControlLayersTree/L.Control.Layers.Tree.css"/>
  <script src="leaflet/plugins/ControlLayersTree/L.Control.Layers.Tree.js"></script>

  <!-- External files for functions and data -->
  <script src="data/data.js"></script>
  <script src="data/ward_boundaries_sp34-6z76.js"></script>
  <script src="functions/city_owned_map_functions.js"></script>
  
  <style>

    .formDiv {
      margin: 10px;
    }

    .validInput {
      background-color: null;
    }

    .invalidInput {
      background-color: pink;
    }

    .center {
      text-align: center;
    }

    .increasedLineHeight {
      line-height: 1.5;
    }

    .message {
      margin: 3px;
    }

    .italic {
      font-style: italic;
    }

    .parentLayer {
      font-weight: bold;
      font-size: 1.15em;
    }

    .leafLayer {
      font-style: italic;
    }

    .bolded {
      font-weight: bold;
    }

    #map {
      width: 100%;
      height: 600px;
      left: 0;
      top: 0;
    }

    #pageHeader {
      text-align: center;
      font-size: 12px;
    }

    #sgmRadiusInput {
      width: 3.5em;
    }

    #pinSearchInput {
      width: 12em;
    }

  </style>
    
</head>

<body>

  <div id="pageHeader">
    <h1>Map of City-Owned Properties</h1>
  </div>

  <p id="mapDescription" class="italic"></p-->

  <div id="savedPinsForm" class="formDiv">
    <button type="button" id="viewSavedPinsButton">View Saved PINs</button>
    <button type="button" id="clearSavedPinsButton">Clear Saved PINs</button>
    <button type="button" id="exportSavedPinsButton">Export Saved PINs</button>
    <span id="exportSavedPinsMessage" class="message"></span>
  </div>

  <div id="pinSearchForm" class="formDiv">
    <label>
      Search for city-owned PIN on map:
      <input type="text" id="pinSearchInput" class="validInput"/>
    </label>
    <button type="button" id="pinSearchButton">
      Search
    </button>
    <span id="pinSearchMessage" class="message"></span>
  </div>

  <div id="sgmRadiusForm" class="formDiv">
    <label>
      Set radius of circle around Sunshine Gospel Ministries (in kilometers):
      <input type="number" id="sgmRadiusInput" class="validInput"/>
    </label>
    <button type="button" id="sgmRadiusSetButton">
      Set Radius
    </button>
    <span id="sgmRadiusMessage" class="message"></span>
  </div>

  <div id="map"></div>

  <script>

    // create map
    const map = L.map("map", {
      center: [41.783, -87.621],
      zoom: 10,
      scrollWheelZoom: false,
      doubleClickZoom: false,
    });

    // add tiles to map - reference: https://leafletjs.com/examples/layers-control/
    const osmtiles = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>"
    }).addTo(map);

    const parentMarkerCluster = L.markerClusterGroup({
      maxClusterRadius: 50,
    }).addTo(map);

    const ward20MarkerGroup = L.featureGroup.subGroup(parentMarkerCluster);
    const otherWardsMarkerGroup = L.featureGroup.subGroup(parentMarkerCluster);

    const cityOwnedPins = Object.keys(data);
    const ward20Marker = L.marker([data[cityOwnedPins[1]].latitude, data[cityOwnedPins[1]].longitude]);
    const otherWardsMarker = L.marker([data[cityOwnedPins[0]].latitude, data[cityOwnedPins[0]].longitude]);

    const baseTree = {
      label: "Base Layers",
      children: [
        { label: "Open StreetMap", layer: osmtiles },
      ]
    };

    const overlayTree = {
      label: "<span class='parentLayer'>Map Layers</span>",
      selectAllCheckbox: true,
      children: [
        {
          label: "<span class='parentLayer'>City-Owned PINs</span>",
          selectAllCheckbox: true,
          collapsed: true,
          children: [
            { label: "<span class='leafLayer'>Ward 20</span>", layer: ward20MarkerGroup },
            { label: "<span class='leafLayer'>Other Wards</span>", layer: otherWardsMarkerGroup },
          ]
        },
        {
          label: "<span class='parentLayer'>Scavenger Sale PINs</span>",
          selectAllCheckbox: true,
          collapsed: true,
          children: [
            { label: "<span class='leafLayer'>Ward 20</span>", layer: L.layerGroup() },
            { label: "<span class='leafLayer'>Other Wards</span>", layer: L.layerGroup() },
          ]
        }
      ]
    };

    ward20MarkerGroup.addTo(map);
    otherWardsMarkerGroup.addTo(map);

    const layerControlTree = L.control.layers.tree(
      baseTree,
      overlayTree,
      {
        collapsed : false,
        hideSingleBase: true,
      }
    ).addTo(map);

    ward20MarkerGroup.addLayer(ward20Marker);
    otherWardsMarkerGroup.addLayer(otherWardsMarker);

    // add map description
    document.getElementById("mapDescription").innerHTML = "This is a map of properties owned by the "
      + "City of Chicago that may be for sale and of interest to Sunshine Gospel Ministries' Housing "
      + "Equity Initiative. The data for the markers on this map comes from the Chicago Data Portal's "
      + `<a href="https://data.cityofchicago.org/Community-Economic-Development/City-Owned-Land-Inventory/aksk-kvfp" target="_blank" rel="noopener">City-Owned Land Inventory dataset</a>`
      + " and Cook County's "
      + `<a href="https://datacatalog.cookcountyil.gov/Property-Taxation/Assessor-Archived-05-11-2022-Property-Locations/c49d-89sn" target="_blank" rel="noopener">Property Locations dataset</a>`
      + ` (accessed on ${accessDateTime}). The ward boundaries data comes from the Chicago Data Portal's `
      + `<a href="https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Wards-2015-/sp34-6z76" target="_blank" rel="noopener">Ward Boundaries dataset</a>`
      + ` (accessed on ${wardBoundariesAccessTime}).`
      + " Click on each marker to view more information about the property it represents,"
      + " and add it to your Saved PINs list by selecting \"Add to Saved PINs\""
      + ` (saved PINs are marked with a checkmark on the map and can be exported for use in other`
      + " applications).";

  </script>   

</body>

</html>

<!-- references:
  https://github.com/Leaflet/Leaflet/tree/main/docs/examples (BSD 2-Clause license)
  https://github.com/Leaflet/Leaflet.markercluster (MIT license)
  https://github.com/ghybs/Leaflet.FeatureGroup.SubGroup (BSD 2-Clause license)
-->
